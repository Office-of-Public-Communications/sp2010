<!-- <html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" xmlns:mso="urn:schemas-microsoft-com:office:office"
        xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882"> -->
<html>
<head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css"
                href="https://broward.org/Style%20Library/V7/css/vendor/mdb/bootstrap.min.css" />
        <style></style>
        <script type="text/javascript" src="https://broward.org/Style%20Library/V7/js/vendor/mdb/jquery-3.3.1.min.js">
        </script>
</head>

<body>

        <!-- Learn about this code on MDN: https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsDataURL -->

        <input id="file" type="file" accept="image/*" onchange="previewFile()"><br>
        <img src="" height="200" alt="Image preview...">

        <!-- <input id="file" type="file" accept="image/*"> -->



        <script>
                document.getElementById("file").addEventListener("change", function (event) {
                        compress(event);
                });

                // compress image using FileReader & Canvas APIs
                function compress(e) {
                        const width = 500;
                        const height = 300;
                        const fileName = e.target.files[0].name;
                        const reader = new FileReader();
                        reader.readAsDataURL(e.target.files[0]);
                        reader.onload = event => {
                                const img = new Image();
                                img.src = event.target.result;
                                img.onload = () => {
                                        const elem = document.createElement('canvas');
                                        elem.setAttribute('id', 'canvas');
                                        console.log(elem);
                                        elem.width = width;
                                        elem.height = height;
                                        const ctx = elem.getContext('2d');
                                        // img.width and img.height will contain the original dimensions
                                        ctx.drawImage(img, 0, 0, width, height);
                                        ctx.canvas.toDataURL('image/jpeg', 0.6);
                                        console.log(ctx.canvas.toDataURL('image/jpeg', 0.6))
                                },
                                reader.onerror = error => console.log(error);
                        };
                }
                // Preview image file in browser
                function previewFile() {
                        var preview = document.querySelector('img');
                        var file = document.querySelector('input[type=file]').files[0];
                        var reader = new FileReader();

                        reader.addEventListener("load", function () {
                                preview.src = reader.result;
                        }, false);

                        if (file) {
                                reader.readAsDataURL(file);
                        }
                }

                // so SP doesn't add metadata after upload
                function uploadAttachment(file) {
                        var dfd = $q.defer();
                        var reader = new FileReader();
                        reader.onload = function (event) {
                                var cache = new Uint8Array(event.target.result);
                                var cfg = $formsConfig;
                                var url = cfg.web() + "_api/web/Lists(guid'" + cfg.listId() + "')/items(" +
                                        $formsConfig
                                        .itemId() +
                                        ")/AttachmentFiles/add(FileName='" + file.name + "')";
                                digestValue.getDigestValue().then(function (digest) {
                                        $http.post(url, cache, {
                                                withCredentials: true,
                                                transformRequest: [],
                                                headers: {
                                                        'accept': 'application/json;odata=verbose',
                                                        'X-RequestDigest': digest,
                                                }
                                        }).success(function (data) {
                                                dfd.resolve(data);
                                        }).error(function () {
                                                dfd.reject();
                                        });
                                });
                        };
                        reader.onerror = function (event) {
                                console.error("File reading error " + event.target.error.code);
                        };
                        reader.readAsArrayBuffer(file);
                        return dfd.promise;
                }


                // url for testing: https://browardauthor/Sandbox/v6/MattDEV/PublishingImages/_api/web/getfilebyserverrelativeurl('/<folder name>/<file name>')
                // get folder --> use this to POST images
                $.ajax({
                        // need to make a variable for getFolderByServer.. folder url based on what directory user selects
                        url: "/_api/web/getFolderByServerRelativeUrl('/PublishingImages')/Files",
                        // should MIME type and/or headers change? see upload function
                        method: "GET",
                        headers: {
                                "Accept": "application/json; odata=verbose"
                        },
                        success: function (data) {
                                var results = data.d.results;
                                console.log(results);
                        }
                });

                // site structure --> use this to create dropdown & create variable for determining folder to put images into
                $.ajax({
                        // need to make a variable for getFolderByServer.. folder url based on what directory user selects
                        url: "/_api/site/rootWeb/webinfos",
                        // should MIME type and/or headers change? see upload function
                        method: "GET",
                        headers: {
                                "Accept": "application/json; odata=verbose"
                        },
                        success: function (data) {
                                var results = data.d.results;
                                console.log(results);
                        }
                });
        </script>
</body>

</html>